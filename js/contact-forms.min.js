const CONFIG={email:{serviceId:"service_6jnewbb",issueTemplateId:"template_bjh7sm3",enquiryTemplateId:"template_l9an0sq",publicKey:"i5TYdclyR0ihs1ZxG",adminEmail:"casadeamorinfo@gmail.com"}};emailjs.init(CONFIG.email.publicKey);let currentForm="issue";const formState={issue:{errors:{},isSubmitting:!1},enquiry:{errors:{},isSubmitting:!1}},validationPatterns={name:/^[a-zA-Z\s]{2,50}$/,email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[\+]?[\d\s\-\(\)]{8,15}$/};function isValidPhoneNumber(e){let t=e.replace(/\D/g,"");return!(t.startsWith("04")&&10!==t.length||t.startsWith("0")&&!t.startsWith("04")&&10!==t.length)&&!(t.length<10)&&!(t.length>15)&&[/^(\+?61\s?)?(\(?0[2-9]\)\s?|\(?0[2-9]\s?\)?)\s?\d{4}\s?\d{4}$/,/^(\+?61\s?)?\(?04\d{2}\)?\s?\d{3}\s?\d{3}$/,/^(\+?61\s?)?\(?1[38]\d{2}\)?\s?\d{3}\s?\d{3}$/,/^(\+?1\s?)?\(?\d{3}\)?\s?[\d\s\-]{7,10}$/,/^(\+?\d{1,3}\s?)?\(?\d{2,4}\)?\s?[\d\s\-]{8,12}$/].some(t=>t.test(e))}function validateField(e,t,i,n){let r=t.trim();switch(i){case"name":if(!r)return"Name is required";if(!validationPatterns.name.test(r))return"Please enter a valid name (2-50 characters, letters only)";break;case"email":if(!r)return"Email is required";if(!validationPatterns.email.test(r))return"Please enter a valid email address";break;case"phone":if(!r)return"Phone number is required";if(!validationPatterns.phone.test(r))return"Phone number format is invalid";if(!isValidPhoneNumber(r))return"Please enter a valid phone number (e.g., (03) 6169 2286 or 0412 345 678)";break;case"date":if(!r)return"Date is required";let s=new Date(r),a=new Date;if(a.setHours(0,0,0,0),s<a)return"Please select a future date";break;case"required":if(!r)return"This field is required";break;case"description":if(!r)return"Description is required";if(r.length<10)return"Please provide at least 10 characters for a meaningful description"}return null}function showFieldError(e,t,i){let n=document.getElementById(`${e}-error`),r=document.getElementById(e);n&&(n.textContent=t,n.style.display="block"),r&&r.classList.add("is-invalid"),formState[i].errors[e]=t}function clearFieldError(e,t){let i=document.getElementById(`${e}-error`),n=document.getElementById(e);i&&(i.textContent="",i.style.display="none"),n&&n.classList.remove("is-invalid"),delete formState[t].errors[e]}function clearAllErrors(e){Object.keys(formState[e].errors).forEach(t=>{clearFieldError(t,e)})}function switchTab(e){currentForm=e;let t=document.getElementById("issue-tab"),i=document.getElementById("enquiry-tab"),n=document.getElementById("issue-form"),r=document.getElementById("enquiry-form");"issue"===e?(t.classList.add("active","orange-bg"),t.classList.remove("orange"),t.setAttribute("aria-selected","true"),i.classList.remove("active","orange-bg","text-white"),i.classList.add("orange"),i.setAttribute("aria-selected","false"),n.classList.add("show","active"),n.classList.remove("fade"),r.classList.remove("show","active"),r.classList.add("fade")):(i.classList.add("active","orange-bg","text-white"),i.classList.remove("orange"),i.setAttribute("aria-selected","true"),t.classList.remove("active","orange-bg","text-white"),t.classList.add("orange"),t.setAttribute("aria-selected","false"),r.classList.add("show","active"),r.classList.remove("fade"),n.classList.remove("show","active"),n.classList.add("fade"))}function toggleContactMethod(){let e=document.getElementById("issue-email-contact"),t=document.getElementById("issue-phone-contact"),i=document.getElementById("issue-email-field"),n=document.getElementById("issue-phone-field"),r=document.getElementById("issue-email"),s=document.getElementById("issue-phone");e&&e.checked?(i.classList.remove("d-none"),n.classList.add("d-none"),s.value="",s.removeAttribute("required"),r.setAttribute("required","required"),clearFieldError("issue-phone","issue")):t&&t.checked?(n.classList.remove("d-none"),i.classList.add("d-none"),r.value="",r.removeAttribute("required"),s.setAttribute("required","required"),clearFieldError("issue-email","issue")):i&&n&&(i.classList.remove("d-none"),n.classList.add("d-none"),s&&s.removeAttribute("required"),r&&r.setAttribute("required","required"))}function toggleEnquiryContactMethod(){let e=document.getElementById("enquiry-email-contact"),t=document.getElementById("enquiry-phone-contact"),i=document.getElementById("enquiry-email-field"),n=document.getElementById("enquiry-phone-field"),r=document.getElementById("enquiry-email"),s=document.getElementById("enquiry-phone");e&&e.checked?(i.classList.remove("d-none"),n.classList.add("d-none"),s.value="",s.removeAttribute("required"),r.setAttribute("required","required"),clearFieldError("enquiry-phone","enquiry")):t&&t.checked?(n.classList.remove("d-none"),i.classList.add("d-none"),r.value="",r.removeAttribute("required"),s.setAttribute("required","required"),clearFieldError("enquiry-email","enquiry")):i&&n&&(i.classList.remove("d-none"),n.classList.add("d-none"),s&&s.removeAttribute("required"),r&&r.setAttribute("required","required"))}function updateCharacterCount(e,t){let i=document.getElementById(e),n=document.getElementById(t);i&&n&&(n.textContent=i.value.length)}function validateForm(e){clearAllErrors(e);let t=!0;if("issue"===e){let i=document.getElementById("issue-name").value,n=document.querySelector('input[name="issue-contact-method"]:checked'),r=document.getElementById("issue-booking-details").value,s=document.getElementById("issue-booking-date").value,a=document.getElementById("issue-booking-time").value,o=document.getElementById("issue-description").value,l=validateField("issue-name",i,"name",e);if(l&&(showFieldError("issue-name",l,e),t=!1),n){if("email"===n.value){let d=document.getElementById("issue-email").value,u=validateField("issue-email",d,"email",e);u&&(showFieldError("issue-email",u,e),t=!1)}else{let m=document.getElementById("issue-phone").value,c=validateField("issue-phone",m,"phone",e);c&&(showFieldError("issue-phone",c,e),t=!1)}}else showFieldError("issue-contact-method","Please select a contact method",e),t=!1;let y=validateField("issue-booking-details",r,"required",e);y&&(showFieldError("issue-booking-details",y,e),t=!1);let g=validateField("issue-booking-date",s,"date",e);g&&(showFieldError("issue-booking-date",g,e),t=!1),a.trim()||(showFieldError("issue-booking-time","Please select a booking time",e),t=!1);let p=validateField("issue-description",o,"description",e);p&&(showFieldError("issue-description",p,e),t=!1)}else{let h=document.getElementById("enquiry-name").value,v=document.querySelector('input[name="enquiry-contact-method"]:checked'),E=document.getElementById("enquiry-date").value,f=document.getElementById("enquiry-time").value,q=document.getElementById("enquiry-people").value,I=document.getElementById("enquiry-event-type").value,b=document.getElementById("enquiry-description").value,B=validateField("enquiry-name",h,"name",e);if(B&&(showFieldError("enquiry-name",B,e),t=!1),v){if("email"===v.value){let k=document.getElementById("enquiry-email").value,F=validateField("enquiry-email",k,"email",e);F&&(showFieldError("enquiry-email",F,e),t=!1)}else{let L=document.getElementById("enquiry-phone").value,w=validateField("enquiry-phone",L,"phone",e);w&&(showFieldError("enquiry-phone",w,e),t=!1)}}else showFieldError("enquiry-contact-method","Please select a contact method",e),t=!1;let C=validateField("enquiry-date",E,"date",e);C&&(showFieldError("enquiry-date",C,e),t=!1),f.trim()||(showFieldError("enquiry-time","Please select a preferred time",e),t=!1),q.trim()||(showFieldError("enquiry-people","Please select number of people",e),t=!1),I.trim()||(showFieldError("enquiry-event-type","Please select an event type",e),t=!1);let _=validateField("enquiry-description",b,"description",e);_&&(showFieldError("enquiry-description",_,e),t=!1)}return t}function showLoading(e){let t=document.getElementById(`${e}-submit-btn`),i=document.getElementById(`${e}-submit-text`),n=document.getElementById(`${e}-loading`);i.classList.add("d-none"),n.classList.remove("d-none"),t.disabled=!0,formState[e].isSubmitting=!0}function hideLoading(e){let t=document.getElementById(`${e}-submit-btn`),i=document.getElementById(`${e}-submit-text`),n=document.getElementById(`${e}-loading`);i.classList.remove("d-none"),n.classList.add("d-none"),t.disabled=!1,formState[e].isSubmitting=!1}function sendEmail(e,t){let i={};i="issue"===t?{to_name:"Casa de Amor Team",to_email:CONFIG.email.adminEmail,from_name:e.name,reply_to:e.contactInfo,subject:"Issue Report - Casa de Amor",form_type:"ISSUE REPORT",contact_method:e.contactMethod,contact_info:e.contactInfo,booking_details:e.bookingDetails,booking_date:e.bookingDate,booking_time:e.bookingTime,walk_in_time:e.walkInTime||"Not provided",walk_out_time:e.walkOutTime||"Not provided",issue_description:e.description,message:`
Issue Report from ${e.name}

Contact Method: ${e.contactMethod}
Contact Info: ${e.contactInfo}
Booking Details: ${e.bookingDetails}
Booking Date: ${e.bookingDate}
Booking Time: ${e.bookingTime}
Walk-in Time: ${e.walkInTime||"Not provided"}
Walk-out Time: ${e.walkOutTime||"Not provided"}

Issue Description:
${e.description}
      `}:{to_name:"Casa de Amor Team",to_email:CONFIG.email.adminEmail,from_name:e.name,reply_to:e.contactInfo,subject:"New Enquiry - Casa de Amor",form_type:"ENQUIRY",contact_method:e.contactMethod,contact_info:e.contactInfo,preferred_date:e.date,date:e.date,preferred_time:e.time,time:e.time,number_of_people:e.people,people:e.people,event_type:e.eventType,eventType:e.eventType,enquiry_description:e.description,description:e.description,message:`From: ${e.name}
Contact Method: ${e.contactMethod}
Contact Info: ${e.contactInfo}
Preferred Date: ${e.date}
Preferred Time: ${e.time}
Number of People: ${e.people}
Event Type: ${e.eventType}

Enquiry Description:
${e.description}`};let n="issue"===t?CONFIG.email.issueTemplateId:CONFIG.email.enquiryTemplateId;return emailjs.send(CONFIG.email.serviceId,n,i)}function handleFormSubmission(e,t){showLoading(e),sendEmail(t,e).then(t=>{hideLoading(e),document.getElementById(`${e}-form-element`).reset(),clearAllErrors(e);let i=new bootstrap.Modal(document.getElementById("success-popup")),n=document.getElementById("success-message");"issue"===e?n.textContent="Thank you for reporting the issue. We'll investigate and get back to you soon.":n.textContent="Thank you for your enquiry! We'll get back to you soon with more information.",i.show(),"issue"===e?updateCharacterCount("issue-description","issue-description-count"):updateCharacterCount("enquiry-description","enquiry-description-count")}).catch(t=>{console.error(`Error submitting ${e} form:`,t),hideLoading(e),alert("Sorry, there was an error sending your message. Please try again or contact us directly.")})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("issue-tab").addEventListener("click",()=>switchTab("issue")),document.getElementById("enquiry-tab").addEventListener("click",()=>switchTab("enquiry")),document.getElementById("issue-email-contact").addEventListener("change",toggleContactMethod),document.getElementById("issue-phone-contact").addEventListener("change",toggleContactMethod),document.getElementById("enquiry-email-contact").addEventListener("change",toggleEnquiryContactMethod),document.getElementById("enquiry-phone-contact").addEventListener("change",toggleEnquiryContactMethod),toggleContactMethod(),toggleEnquiryContactMethod(),document.getElementById("issue-description").addEventListener("input",function(){updateCharacterCount("issue-description","issue-description-count")}),document.getElementById("enquiry-description").addEventListener("input",function(){updateCharacterCount("enquiry-description","enquiry-description-count")}),document.getElementById("issue-form-element").addEventListener("submit",function(e){if(e.preventDefault(),formState.issue.isSubmitting||!validateForm("issue"))return;let t=document.querySelector('input[name="issue-contact-method"]:checked'),i="email"===t.value?document.getElementById("issue-email").value:document.getElementById("issue-phone").value,n={name:document.getElementById("issue-name").value,contactMethod:t.value,contactInfo:i,bookingDetails:document.getElementById("issue-booking-details").value,bookingDate:document.getElementById("issue-booking-date").value,bookingTime:document.getElementById("issue-booking-time").value,walkInTime:document.getElementById("issue-walk-in-time").value,walkOutTime:document.getElementById("issue-walk-out-time").value,description:document.getElementById("issue-description").value};handleFormSubmission("issue",n)}),document.getElementById("enquiry-form-element").addEventListener("submit",function(e){if(e.preventDefault(),formState.enquiry.isSubmitting||!validateForm("enquiry"))return;let t=document.querySelector('input[name="enquiry-contact-method"]:checked'),i="email"===t.value?document.getElementById("enquiry-email").value:document.getElementById("enquiry-phone").value,n={name:document.getElementById("enquiry-name").value,contactMethod:t.value,contactInfo:i,date:document.getElementById("enquiry-date").value,time:document.getElementById("enquiry-time").value,people:document.getElementById("enquiry-people").value,eventType:document.getElementById("enquiry-event-type").value,description:document.getElementById("enquiry-description").value};handleFormSubmission("enquiry",n)}),[{id:"issue-name",type:"name",form:"issue"},{id:"issue-email",type:"email",form:"issue"},{id:"issue-phone",type:"phone",form:"issue"},{id:"issue-booking-date",type:"date",form:"issue"},{id:"enquiry-name",type:"name",form:"enquiry"},{id:"enquiry-email",type:"email",form:"enquiry"},{id:"enquiry-phone",type:"phone",form:"enquiry"},{id:"enquiry-date",type:"date",form:"enquiry"}].forEach(e=>{let t=document.getElementById(e.id);t&&t.addEventListener("blur",function(){let t=this.value;if(t.trim()){let i=validateField(e.id,t,e.type,e.form);i?showFieldError(e.id,i,e.form):clearFieldError(e.id,e.form)}})})});
