const CONFIG={email:{serviceId:'service_6jnewbb',issueTemplateId:'template_bjh7sm3',enquiryTemplateId:'template_l9an0sq',publicKey:'i5TYdclyR0ihs1ZxG',adminEmail:'casadeamorinfo@gmail.com'}};
(function(){emailjs.init(CONFIG.email.publicKey)})();
let currentForm='issue';
const formState={issue:{errors:{},isSubmitting:!1},enquiry:{errors:{},isSubmitting:!1}};
const validationPatterns={name:/^[a-zA-Z\s]{2,50}$/,email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[\+]?[\d\s\-\(\)]{8,15}$/};
function validateField(fieldId,value,type,formType){const trimmedValue=value.trim();switch(type){case'name':if(!trimmedValue)return'Name is required';if(!validationPatterns.name.test(trimmedValue))return'Please enter a valid name (2-50 characters, letters only)';break;case'email':if(!trimmedValue)return'Email is required';if(!validationPatterns.email.test(trimmedValue))return'Please enter a valid email address';break;case'phone':if(!trimmedValue)return'Phone number is required';if(!validationPatterns.phone.test(trimmedValue))return'Please enter a valid phone number';break;case'date':if(!trimmedValue)return'Date is required';const selectedDate=new Date(trimmedValue),today=new Date;if(today.setHours(0,0,0,0),selectedDate<today)return'Please select a future date';break;case'required':if(!trimmedValue)return'This field is required'}return null}
function showFieldError(fieldId,message,formType){const errorElement=document.getElementById(`${fieldId}-error`),inputElement=document.getElementById(fieldId);errorElement&&(errorElement.textContent=message,errorElement.style.display='block'),inputElement&&inputElement.classList.add('is-invalid'),formState[formType].errors[fieldId]=message}
function clearFieldError(fieldId,formType){const errorElement=document.getElementById(`${fieldId}-error`),inputElement=document.getElementById(fieldId);errorElement&&(errorElement.textContent='',errorElement.style.display='none'),inputElement&&inputElement.classList.remove('is-invalid'),delete formState[formType].errors[fieldId]}
function clearAllErrors(formType){Object.keys(formState[formType].errors).forEach(fieldId=>{clearFieldError(fieldId,formType)})}
function switchTab(tabType){currentForm=tabType;const issueTab=document.getElementById('issue-tab'),enquiryTab=document.getElementById('enquiry-tab'),issueForm=document.getElementById('issue-form'),enquiryForm=document.getElementById('enquiry-form');if('issue'===tabType){issueTab.classList.add('active','orange-bg','text-white'),issueTab.classList.remove('bg-white','text-dark'),issueTab.setAttribute('aria-selected','true'),enquiryTab.classList.remove('active','orange-bg','text-white'),enquiryTab.classList.add('bg-white','text-dark'),enquiryTab.setAttribute('aria-selected','false'),issueForm.classList.add('show','active'),issueForm.classList.remove('fade'),enquiryForm.classList.remove('show','active'),enquiryForm.classList.add('fade')}else{enquiryTab.classList.add('active','orange-bg','text-white'),enquiryTab.classList.remove('bg-white','text-dark'),enquiryTab.setAttribute('aria-selected','true'),issueTab.classList.remove('active','orange-bg','text-white'),issueTab.classList.add('bg-white','text-dark'),issueTab.setAttribute('aria-selected','false'),enquiryForm.classList.add('show','active'),enquiryForm.classList.remove('fade'),issueForm.classList.remove('show','active'),issueForm.classList.add('fade')}}
function toggleContactMethod(){const emailRadio=document.getElementById('issue-email-contact'),phoneRadio=document.getElementById('issue-phone-contact'),emailField=document.getElementById('issue-email-field'),phoneField=document.getElementById('issue-phone-field');emailRadio&&emailRadio.checked?(emailField.classList.remove('d-none'),phoneField.classList.add('d-none'),document.getElementById('issue-phone').value='',clearFieldError('issue-phone','issue')):phoneRadio&&phoneRadio.checked?(phoneField.classList.remove('d-none'),emailField.classList.add('d-none'),document.getElementById('issue-email').value='',clearFieldError('issue-email','issue')):emailField&&phoneField&&(emailField.classList.remove('d-none'),phoneField.classList.add('d-none'))}
function updateCharacterCount(textareaId,counterId){const textarea=document.getElementById(textareaId),counter=document.getElementById(counterId);textarea&&counter&&(counter.textContent=textarea.value.length)}
function validateForm(formType){clearAllErrors(formType);let isValid=!0;if('issue'===formType){const name=document.getElementById('issue-name').value,contactMethod=document.querySelector('input[name="issue-contact-method"]:checked'),bookingDetails=document.getElementById('issue-booking-details').value,bookingDate=document.getElementById('issue-booking-date').value,bookingTime=document.getElementById('issue-booking-time').value,description=document.getElementById('issue-description').value,nameError=validateField('issue-name',name,'name',formType);if(nameError&&(showFieldError('issue-name',nameError,formType),isValid=!1),contactMethod){if('email'===contactMethod.value){const email=document.getElementById('issue-email').value,emailError=validateField('issue-email',email,'email',formType);emailError&&(showFieldError('issue-email',emailError,formType),isValid=!1)}else{const phone=document.getElementById('issue-phone').value,phoneError=validateField('issue-phone',phone,'phone',formType);phoneError&&(showFieldError('issue-phone',phoneError,formType),isValid=!1)}}else showFieldError('issue-contact-method','Please select a contact method',formType),isValid=!1;const bookingDetailsError=validateField('issue-booking-details',bookingDetails,'required',formType);bookingDetailsError&&(showFieldError('issue-booking-details',bookingDetailsError,formType),isValid=!1);const bookingDateError=validateField('issue-booking-date',bookingDate,'date',formType);bookingDateError&&(showFieldError('issue-booking-date',bookingDateError,formType),isValid=!1),bookingTime.trim()||(showFieldError('issue-booking-time','Please select a booking time',formType),isValid=!1);const descriptionError=validateField('issue-description',description,'required',formType);descriptionError&&(showFieldError('issue-description',descriptionError,formType),isValid=!1)}else{const name=document.getElementById('enquiry-name').value,contact=document.getElementById('enquiry-contact').value,date=document.getElementById('enquiry-date').value,time=document.getElementById('enquiry-time').value,people=document.getElementById('enquiry-people').value,description=document.getElementById('enquiry-description').value,nameError=validateField('enquiry-name',name,'name',formType);nameError&&(showFieldError('enquiry-name',nameError,formType),isValid=!1);const contactError=validateField('enquiry-contact',contact,'phone',formType);contactError&&(showFieldError('enquiry-contact',contactError,formType),isValid=!1);const dateError=validateField('enquiry-date',date,'date',formType);dateError&&(showFieldError('enquiry-date',dateError,formType),isValid=!1),time.trim()||(showFieldError('enquiry-time','Please select a preferred time',formType),isValid=!1),people.trim()||(showFieldError('enquiry-people','Please select number of people',formType),isValid=!1);const descriptionError=validateField('enquiry-description',description,'required',formType);descriptionError&&(showFieldError('enquiry-description',descriptionError,formType),isValid=!1)}return isValid}
function showLoading(formType){const submitBtn=document.getElementById(`${formType}-submit-btn`),submitText=document.getElementById(`${formType}-submit-text`),loadingSpinner=document.getElementById(`${formType}-loading`);submitText.classList.add('d-none'),loadingSpinner.classList.remove('d-none'),submitBtn.disabled=!0,formState[formType].isSubmitting=!0}
function hideLoading(formType){const submitBtn=document.getElementById(`${formType}-submit-btn`),submitText=document.getElementById(`${formType}-submit-text`),loadingSpinner=document.getElementById(`${formType}-loading`);submitText.classList.remove('d-none'),loadingSpinner.classList.add('d-none'),submitBtn.disabled=!1,formState[formType].isSubmitting=!1}
function sendEmail(formData,formType){let templateParams={};if('issue'===formType)templateParams={to_name:'Casa de Amor Team',to_email:CONFIG.email.adminEmail,from_name:formData.name,reply_to:formData.contactInfo,subject:'Issue Report - Casa de Amor',form_type:'ISSUE REPORT',contact_method:formData.contactMethod,contact_info:formData.contactInfo,booking_details:formData.bookingDetails,booking_date:formData.bookingDate,booking_time:formData.bookingTime,walk_in_time:formData.walkInTime||'Not provided',walk_out_time:formData.walkOutTime||'Not provided',issue_description:formData.description,message:`Issue Report from ${formData.name}\n\nContact Method: ${formData.contactMethod}\nContact Info: ${formData.contactInfo}\nBooking Details: ${formData.bookingDetails}\nBooking Date: ${formData.bookingDate}\nBooking Time: ${formData.bookingTime}\nWalk-in Time: ${formData.walkInTime||'Not provided'}\nWalk-out Time: ${formData.walkOutTime||'Not provided'}\n\nIssue Description:\n${formData.description}\n      `};else templateParams={to_name:'Casa de Amor Team',to_email:CONFIG.email.adminEmail,from_name:formData.name,from_email:formData.contact,reply_to:formData.contact,subject:'New Enquiry - Casa de Amor',form_type:'ENQUIRY',contact_number:formData.contact,phone:formData.contact,preferred_date:formData.date,date:formData.date,preferred_time:formData.time,time:formData.time,number_of_people:formData.people,people:formData.people,enquiry_description:formData.description,description:formData.description,message:`From: ${formData.name}\nPhone: ${formData.contact}\nPreferred Date: ${formData.date}\nPreferred Time: ${formData.time}\nNumber of People: ${formData.people}\n\nEnquiry Description:\n${formData.description}`};const templateId='issue'===formType?CONFIG.email.issueTemplateId:CONFIG.email.enquiryTemplateId;return emailjs.send(CONFIG.email.serviceId,templateId,templateParams)}
function handleFormSubmission(formType,formData){showLoading(formType),sendEmail(formData,formType).then(response=>{hideLoading(formType),document.getElementById(`${formType}-form-element`).reset(),clearAllErrors(formType);const modal=new bootstrap.Modal(document.getElementById('success-popup')),successMessage=document.getElementById('success-message');'issue'===formType?successMessage.textContent='Thank you for reporting the issue. We\'ll investigate and get back to you soon.':successMessage.textContent='Thank you for your enquiry! We\'ll get back to you soon with more information.',modal.show(),'issue'===formType?updateCharacterCount('issue-description','issue-description-count'):updateCharacterCount('enquiry-description','enquiry-description-count')}).catch(error=>{console.error(`Error submitting ${formType} form:`,error),hideLoading(formType),alert('Sorry, there was an error sending your message. Please try again or contact us directly.')})}
document.addEventListener('DOMContentLoaded',function(){document.getElementById('issue-tab').addEventListener('click',()=>switchTab('issue')),document.getElementById('enquiry-tab').addEventListener('click',()=>switchTab('enquiry')),document.getElementById('issue-email-contact').addEventListener('change',toggleContactMethod),document.getElementById('issue-phone-contact').addEventListener('change',toggleContactMethod),toggleContactMethod(),document.getElementById('issue-description').addEventListener('input',function(){updateCharacterCount('issue-description','issue-description-count')}),document.getElementById('enquiry-description').addEventListener('input',function(){updateCharacterCount('enquiry-description','enquiry-description-count')}),document.getElementById('issue-form-element').addEventListener('submit',function(e){if(e.preventDefault(),!formState.issue.isSubmitting&&validateForm('issue')){const contactMethod=document.querySelector('input[name="issue-contact-method"]:checked'),contactInfo='email'===contactMethod.value?document.getElementById('issue-email').value:document.getElementById('issue-phone').value,formData={name:document.getElementById('issue-name').value,contactMethod:contactMethod.value,contactInfo:contactInfo,bookingDetails:document.getElementById('issue-booking-details').value,bookingDate:document.getElementById('issue-booking-date').value,bookingTime:document.getElementById('issue-booking-time').value,walkInTime:document.getElementById('issue-walk-in-time').value,walkOutTime:document.getElementById('issue-walk-out-time').value,description:document.getElementById('issue-description').value};handleFormSubmission('issue',formData)}}),document.getElementById('enquiry-form-element').addEventListener('submit',function(e){if(e.preventDefault(),!formState.enquiry.isSubmitting&&validateForm('enquiry')){const formData={name:document.getElementById('enquiry-name').value,contact:document.getElementById('enquiry-contact').value,date:document.getElementById('enquiry-date').value,time:document.getElementById('enquiry-time').value,people:document.getElementById('enquiry-people').value,description:document.getElementById('enquiry-description').value};handleFormSubmission('enquiry',formData)}});const validationFields=[{id:'issue-name',type:'name',form:'issue'},{id:'issue-email',type:'email',form:'issue'},{id:'issue-phone',type:'phone',form:'issue'},{id:'issue-booking-date',type:'date',form:'issue'},{id:'enquiry-name',type:'name',form:'enquiry'},{id:'enquiry-contact',type:'phone',form:'enquiry'},{id:'enquiry-date',type:'date',form:'enquiry'}];validationFields.forEach(field=>{const element=document.getElementById(field.id);element&&element.addEventListener('blur',function(){const value=this.value;if(value.trim()){const error=validateField(field.id,value,field.type,field.form);error?showFieldError(field.id,error,field.form):clearFieldError(field.id,field.form)}})})});
window.onscroll=function(){var navbar=document.querySelector('.navbar');window.scrollY>50?navbar.classList.add('navbar-fixed'):navbar.classList.remove('navbar-fixed')};